private string GetFullExceptionDetails(Exception ex)
{
    var sb = new StringBuilder();

    while (ex != null)
    {
        sb.AppendLine($"Message: {ex.Message}");
        sb.AppendLine($"Source: {ex.Source}");
        sb.AppendLine($"StackTrace: {ex.StackTrace}");
        ex = ex.InnerException;
        if (ex != null)
        {
            sb.AppendLine("---- Inner Exception ----");
        }
    }

    return sb.ToString();
}



private async Task LogAsync(string level, string message, string category,
                              object? data = null, Exception? ex = null, string? referenceType = null, int? referenceId=null)
{
    var logEntry = new LogEntry
    {
        ReferenceId = referenceId,
        ReferenceType = referenceType,
        Level = level,
        Message = message,
        Category = category,
        Data = data != null ? JsonSerializer.Serialize(data) : null,
        Exception = ex != null ? GetFullExceptionDetails(ex) : null,
        TimeStamp = DateTime.UtcNow  // Add timestamp if not already in entity
    };

    await _logRepository.AddAsync(logEntry);
}




try
{
    // some logic
}
catch (Exception ex)
{
    await _logger.LogError("Customer entry failed!", "Services.PolicyService", data: customerDto, ex: ex);
    throw;
}


protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    base.OnModelCreating(modelBuilder);

    modelBuilder.Entity<LogEntry>(entity =>
    {
        entity.Property(e => e.Exception)
              .HasColumnType("nvarchar(max)");

        entity.Property(e => e.Data)
              .HasColumnType("nvarchar(max)");
    });
}



SELECT COLUMN_NAME, DATA_TYPE, CHARACTER_MAXIMUM_LENGTH
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'LogEntry' AND COLUMN_NAME = 'Exception';







